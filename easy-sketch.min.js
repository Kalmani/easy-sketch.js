var EasySketch=EasySketch||{};EasySketch.EventManager=function(b){var a=this;this.manager=$(b);return{trigger:function(c,d){a.manager.trigger(c,d||null)},attach:function(c,d,e){a.manager.on(c,e||null,d)},detach:function(c,d){a.manager.unbind(c,d)}}};EasySketch.Sketch=function(b,a){var c=this;this.binded=false;this.drawing=false;this.events=new EasySketch.EventManager(this);this.eraser=false;this.canvas=this.__createCanvas(b);this.context=this.canvas.get(0).getContext("2d");this.options={color:"#000000",width:5,bindingObject:null};if(a){this.setOptions(a)}this.__attachListeners()};EasySketch.Sketch.START_PAINTING_EVENT="sketch.start";EasySketch.Sketch.PAINT_EVENT="sketch.paint";EasySketch.Sketch.STOP_PAINTING_EVENT="sketch.stop";EasySketch.Sketch.prototype.setOptions=function(a){this.options=$.extend(this.options,a||{});if(this.options.bindingObject instanceof jQuery===false){this.options.bindingObject=$(this.options.bindingObject)}return this};EasySketch.Sketch.prototype.getOption=function(b,a){a=a||null;if(this.options.hasOwnProperty(b)){return this.options[b]}return a};EasySketch.Sketch.prototype.getEventManager=function(){return this.events};EasySketch.Sketch.prototype.__createCanvas=function(c){var b;var a=typeof c;switch(a){case"string":if(c.indexOf("#")===0){b=$(c)}else{if(c.indexOf(".")===-1){b=$("#"+c)}}break;case"object":if(c instanceof jQuery){b=c}else{b=$(c)}break}return b};EasySketch.Sketch.prototype.__attachListeners=function(){if(this.binded===true){return this}this.binded=true;var a;if(this.getOption("bindingObject")!==null){a=this.options.bindingObject}else{a=this.canvas}var d=this.__startDrawing.bind(this);var b=this.__draw.bind(this);var c=this.__stopDrawing.bind(this);a.on("mousedown touchstart",d);a.on("mousemove touchmove",b);a.on("mouseup mouseleave mouseout touchend touchcancel",c);this.events.attach(EasySketch.Sketch.START_PAINTING_EVENT,d);this.events.attach(EasySketch.Sketch.PAINT_EVENT,b);this.events.attach(EasySketch.Sketch.STOP_PAINTING_EVENT,c);return this};EasySketch.Sketch.prototype.detachListeners=function(){if(this.binded===false){return this}this.binded=false;var a;if(this.getOption("bindingObject")!==null){a=this.options.bindingObject}else{a=this.canvas}var d=this.__startDrawing.bind(this);var b=this.__draw.bind(this);var c=this.__stopDrawing.bind(this);a.off("mousedown touchstart",d);a.off("mousemove touchmove",b);a.off("mouseup mouseleave mouseout touchend touchcancel",c);this.events.detach(EasySketch.Sketch.START_PAINTING_EVENT,d);this.events.detach(EasySketch.Sketch.PAINT_EVENT,b);this.events.detach(EasySketch.Sketch.STOP_PAINTING_EVENT,c);return this};EasySketch.Sketch.prototype.getPointerPosition=function(b){var a=this;return{x:b.pageX-a.canvas.offset().left,y:b.pageY-a.canvas.offset().top}};EasySketch.Sketch.prototype.enableEraser=function(a){this.eraser=a;return this};EasySketch.Sketch.prototype.__startDrawing=function(c,d){if(this.drawing===true){console.log("Something if definitely wrong here...");return this}this.canvas.css("cursor","pointer");var b=d||this.getPointerPosition(c);var a=this.options.color;this.drawing=true;this.context.save();if(this.eraser){a="rgba(0,0,0,0)";this.context.save();this.context.globalCompositeOperation="copy"}this.context.strokeStyle=a;this.context.lineWidth=this.options.width;this.context.lineCap="round";this.context.lineJoin="round";this.context.beginPath();this.context.moveTo(b.x,b.y);return this};EasySketch.Sketch.prototype.__draw=function(b,c){if(this.drawing===false){console.log("How about starting the drawing first?");return this}var a=c||this.getPointerPosition(b);this.context.lineTo(a.x,a.y);this.context.stroke();return this};EasySketch.Sketch.prototype.__stopDrawing=function(){if(this.drawing===false){console.log("Nothing to stop...");return this}this.drawing=false;this.canvas.css("cursor","auto");this.context.restore();this.context.restore();return this};EasySketch.Sketch.prototype.drawLine=function(c){var a=c.slice();var b=a[0];this.__startDrawing(null,b);while(a.length>0){b=a.shift();this.context.lineTo(b.x,b.y)}this.context.stroke();this.__stopDrawing();return this};